<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <title>Timothée’s classroom</title>
    <style>
        [hidden] {
            display: none;
        }
    </style>
</head>
<body>
    <form name="orthographe">
        <label hidden>
            <span>Quel mot as-tu as entendu&nbsp;?</span>
            <input type="text" name="mot">
        </label>
        <div class="action">
            <button type="button" name="again" hidden>Réécouter</button>
            <button name="submit">Écouter un mot</button>
        </div>
    </form>
<script>
    (function () {
        const data = {
            soundList: [
                {
                    src: 'aujourd-hui.mp3',
                    answer: 'aujourd’hui'
                },
                {
                    src: 'autour.mp3',
                    answer: 'autour'
                },
                {
                    src: 'bonjour.mp3',
                    answer: 'bonjour'
                },
                {
                    src: 'dessous.mp3',
                    answer: 'dessous'
                },
                {
                    src: 'la-couleur.mp3',
                    answer: 'la couleur'
                },
                {
                    src: 'la-cour.mp3',
                    answer: 'la cour'
                },
                {
                    src: 'la-musique.mp3',
                    answer: 'la musique'
                },
                {
                    src: 'la-route.mp3',
                    answer: 'la route'
                },
                {
                    src: 'oui.mp3',
                    answer: 'oui'
                },
                {
                    src: 'pour.mp3',
                    answer: 'pour'
                },
                {
                    src: 'rouge.mp3',
                    answer: 'rouge'
                },
                {
                    src: 'sous.mp3',
                    answer: 'sous'
                },
                {
                    src: 'sur.mp3',
                    answer: 'sur'
                },
                {
                    src: 'surtout.mp3',
                    answer: 'surtout'
                },
                {
                    src: 'toujours.mp3',
                    answer: 'toujours'
                },
                {
                    src: 'une-journee.mp3',
                    answer: 'une journée'
                },
                {
                    src: 'une-souris.mp3',
                    answer: 'une souris'
                },
            ]
        };

        const sound = (function() {
            let audio = null;

            function replay() {
                if (!audio) {
                    return null;
                }
                audio.play();
            }

            function play(url) {
                audio = new Audio(url);
                audio.play();
            }

            return {
                play,
                replay,
            }
        })();

        function randomInArray(array) {
            return array[Math.floor(Math.random() * array.length)];
        }

        function cleanProposal(string) {
            return string
                .trim()
                .toLowerCase()
                .replace(/'/g, '’');
        }

        const form = document.forms.orthographe;
        const input = form.mot;
        const submitButton = form.submit;
        const againButton = form.again;
        const formLabel = form.querySelector('label');
        let currentSound;

        form.addEventListener('submit', function (event) {
            event.preventDefault();
            if (currentSound) {
                const proposal = cleanProposal(input.value);
                if (proposal === currentSound.answer) {
                    alert('Bravo !');
                } else {
                    alert('Dommage ! C’était « ' + currentSound.answer + ' ».');
                }
                input.value = '';
                currentSound = null;
                submitButton.innerHTML = 'Mot suivant';
                againButton.setAttribute('hidden', true);
                formLabel.setAttribute('hidden', true);
            } else {
                currentSound = randomInArray(data.soundList);
                sound.play('./sounds/' + currentSound.src);
                submitButton.innerHTML = 'Valider';
                againButton.removeAttribute('hidden');
                formLabel.removeAttribute('hidden');
            }
        });

        againButton.addEventListener('click', function () {
            sound.replay();
        })
    })();
</script>
</body>
</html>